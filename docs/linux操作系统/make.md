使用上一节的 main.c、add.c、sub.c文件进行编译，编译的过程有很多步骤，如果要重新编译，还需要再重来一遍，能不能一步完成这些步骤?将这些步骤写到makefile文件中，通过make工具进行编译

![](https://cdn.nlark.com/yuque/0/2024/png/40599201/1709375512342-093a5708-98fa-468b-8025-e45c6c7d069d.png)

一个工程中的源文件不计其数，其按类型、功能、模块分别放在若干个目录中，makefile定义了一系列的规则来指定哪些文件需要先编译，哪些文件需要后编译，哪些文件需要重新编译，甚至于进行更复杂的功能操作，因为makefile 就像一个Shell脚本一样，也可以执行操作系统的命令

## 一、介绍
### 1.概述
Linux环境下的程序员如果不会使用GNU make来构建和管理自己的工程，应该不能算是一个合格的专业程序员，至少不能称得上是Unix程序员。在Linux (unix）环境下使用GNU的make工具能够比较容易的构建一个属于你自己的工程，整个工程的编译只需要一个命令就可以完成编译、连接以至于最后的执行。不过这需要我们投入一些时间去完成一个或者多个称之为Makefile 文件的编写。

所要完成的 Makefile文件描述了整个工程的编译、连接等规则。其中包括:工程中的哪些源文件需要编译以及如何编译、需要创建哪些库文件以及如何创建这些库文件、如何最后产生我们想要的可执行文件。尽管看起来可能是很复杂的事情，但是为工程编写Makefile的好处是能够使用一行命令来完成“自动化编译”，一旦提供一个(通常对于一个工程来说会是多个)正确的 Makefile。编译整个工程你所要做的事就是在shell提示符下输入make命令。整个工程完全自动编译，极大提高了效率。

make是一个命令工具，它解释Makefile 中的指令。在Makefile文件中描述了整个工程所有文件的编译顺序、编译规则。Makefile有自己的书写格式、关键字、函数。像C语言有自己的格式、关键字和函数一样。而且在Makefile 中可以使用系统shell所提供的任何命令来完成想要的工作。Makefile在绝大多数的IDE 开发环境中都在使用，已经成为一种工程的编译方法。

### 2.功能
Make 工具最主要也是最基本的功能就是通过 makefile文件来描述源程序之间的相互关系并自动维护编译工作。而makefile文件需要按照某种语法进行编写，文件中需要说明如何编译各个源文件并连接生成可执行文件，并要求定义源文件之间的依赖关系。makefile文件是许多编译器--包括Windows NT下的编译器--维护编译信息的常用方法，只是在集成开发环境中，用户通过友好的界面修改makefile文件而已。

在UNIX系统中，习惯使用Makefile作为makefile文件。如果要使用其他文件作为makefile，则可利用类似下面的make 命令选项指定makefile文件（(通过参数-f指定我们的Makefile文件):

假设我们写的makefile文件名字叫做lib.mk

```objectivec
make -f lib.mk
```

## 二、书写规则
+ 一个基本规则:

```objectivec
目标:依赖条件
(一个tab缩进)）命令
```

+ 两个常用函数:
+ wildcard 参数:按给定参数匹配文件名。例如: src = $(wildcard *.c)，匹配当前目录下所有.c文件，将文件名组成列表赋值给src
+ patsubst参数1,参数2,参数3∶将参数3中，模式字符串替换，包含参数1的部分，替换为参数2。例如:obj = $(patsubst %.c，%.o,$(src))，当前目录所有.c文件替换成.o文件赋值给obj
+ 三个自动变量:
+ $@:在规则的命令中，表示规则中的目标
+ $^:在规则的命令中，表示所有依赖条件
+ $<:在规则的命令中，第一个依赖条件(如果将该变量应用在模式规则中它可将依赖条件列表中的依赖依次取出，套用模式规则)

## 三、基本规则
规则包含两个部分，一个是依赖关系，一个是生成目标的方法(就是命令)。

在Makefile 中，规则的顺序是很重要的，因为，Makefile 中只应该有一个最终目标，其它的目标都是被这个目标所连带出来的，所以一定要让make 知道你的最终目标是什么。一般来说，定义在Makefile 中的目标可能会有很多，但是第一条规则中的目标将被确立为最终的目标。如果第一条规则中的目标有很多个，那么，第一个目标会成为最终的目标。make 所完成的也就是这个目标，也可以通过ALL指定我们的最终目标。

+ 常用规则:

```objectivec
targets :prerequisites
(tab) command
```

以gcc hello.c -o hello 举例:

```objectivec
hello: hello.c
gcc hello.c -o hello
```



